# Solution

> Truy cáº­p vÃ o Ä‘Æ°á»ng dáº«n "https://nicc-apache-aint-so-bad.chals.io/" sáº½ hiá»ƒn thá»‹ trang web

![image1](https://live.staticflickr.com/65535/52748689072_49ab00deb7_c.jpg)

> CÃ³ dÃ²ng text "page" cÃ³ thá»ƒ lÃ  má»™t Ä‘Æ°á»ng dáº«n vÃ  view source cho tháº¥y Ä‘Ã³ lÃ  Ä‘Æ°á»ng dáº«n Ä‘áº¿n flag Ä‘Æ°á»£c lÆ°u trá»¯ á»Ÿ **"secret/flag.txt"** vá»›i url lÃ  : **https://nicc-apache-aint-so-bad.chals.io/secret/flag.txt**
> NhÆ°ng khi ta truy cáº­p vÃ o Ä‘Æ°á»ng dáº«n trang web Ä‘Ã£ hiá»‡n lÃªn thÃ´ng bÃ¡o vá»›i status code lÃ  403 Forbidden vÃ  Ä‘oáº¡n text **"You don't have permission to access this resource."** nghÄ©a lÃ  quyá»n Ä‘á»‘i vá»›i user lÃ  khÃ´ng Ä‘Æ°á»£c phÃ©p.
> Quay láº¡i trang web gá»‘c ta tháº¥y cÃ³ Ä‘oáº¡n hint cho challenge nÃ y

```
     RewriteEngine On
            RewriteCond %{THE_REQUEST} flag
            RewriteRule ".*" "-" [F]
```

> á»ž Ä‘Ã¢y ta cÃ³ thá»ƒ Ä‘á»c hiá»ƒu nÃ³ má»™t cÃ¡ch Ä‘Æ¡n giáº£n Ä‘Ã¢y lÃ  má»™t Ä‘oáº¡n mÃ£ trong tá»‡p tin cáº¥u hÃ¬nh cá»§a Apache web server Ä‘á»ƒ thá»±c hiá»‡n chá»©c nÄƒng "URL rewriting" vÃ  "access control". NÃ³ sá»­ dá»¥ng module "mod_rewrite" cá»§a Apache Ä‘á»ƒ Ã¡nh xáº¡ láº¡i URL vÃ  cháº·n cÃ¡c yÃªu cáº§u cÃ³ chá»©a tá»« "flag".
> Cá»¥ thá»ƒ, Ä‘oáº¡n mÃ£ nÃ y bao gá»“m:

- DÃ²ng Ä‘áº§u tiÃªn "RewriteEngine On" báº­t tÃ­nh nÄƒng "URL rewriting" cá»§a module "mod_rewrite".
- DÃ²ng thá»© hai "RewriteCond %{THE_REQUEST} flag" thiáº¿t láº­p má»™t Ä‘iá»u kiá»‡n Ä‘á»ƒ kiá»ƒm tra xem yÃªu cáº§u cÃ³ chá»©a tá»« "flag" khÃ´ng.
- DÃ²ng thá»© ba "RewriteRule ".\*" "-" [F]" Ã¡p dá»¥ng má»™t quy táº¯c Ã¡nh xáº¡ láº¡i URL, trong Ä‘Ã³ má»i URL Ä‘á»u Ä‘Æ°á»£c Ã¡nh xáº¡ Ä‘áº¿n dáº¥u gáº¡ch ngang "-" vÃ  tráº£ vá» mÃ£ tráº¡ng thÃ¡i HTTP 403 "Forbidden" ([F]) cho báº¥t ká»³ yÃªu cáº§u nÃ o thá»a mÃ£n Ä‘iá»u kiá»‡n cá»§a RewriteCond.

  > VÃ¬ váº­y á»Ÿ Ä‘Ã¢y ta cÃ³ thá»ƒ tÃ¬m cÃ¡ch bypass khá»i bá»™ lá»c tá»« flag nÃ y, Ä‘Æ¡n giáº£n nháº¥t Ä‘Ã³ chÃ­nh lÃ  mÃ£ hÃ³a URL hay Ä‘Ãºng nháº¥t lÃ  encode **flag** Ä‘á»ƒ **"fooling the filtering"**
  > MÃ£ hÃ³a URL chuyá»ƒn Ä‘á»•i cÃ¡c kÃ½ tá»± thÃ nh má»™t Ä‘á»‹nh dáº¡ng cÃ³ thá»ƒ Ä‘Æ°á»£c truyá»n qua Internet. URL chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c gá»­i qua Internet báº±ng cÃ¡ch sá»­ dá»¥ng bá»™ kÃ½ tá»± ASCII. VÃ¬ cÃ¡c URL thÆ°á»ng chá»©a cÃ¡c kÃ½ tá»± bÃªn ngoÃ i bá»™ ASCII, URL pháº£i Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i thÃ nh Ä‘á»‹nh dáº¡ng ASCII há»£p lá»‡. MÃ£ hÃ³a URL thay tháº¿ cÃ¡c kÃ½ tá»± ASCII khÃ´ng an toÃ n vá»›i "%" theo sau lÃ  hai chá»¯ sá»‘ tháº­p lá»¥c phÃ¢n.
  > ChÃºng ta cÃ³ thá»ƒ xem bá»™ mÃ£ hÃ³a **"ASCII Encoding Reference"** á»Ÿ [ASCII Encoding Reference](https://www.w3schools.com/tags/ref_urlencode.ASP). VÃ  theo ta Ä‘á»c Ä‘Æ°á»£c á»Ÿ Ä‘Ã¢y , tÃ´i sáº½ thay tháº¿ "f" thÃ nh "%66" , l thÃ nh "%6C" , "a" thÃ nh "%61" vÃ  cuá»‘i cÃ¹ng "g" thÃ nh "%67". Váº­y ta sáº½ thay tháº¿ "flag" thÃ nh **"%66%6C%61%67"**.

  > Ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng CURL command hoáº·c sá»­a Ä‘á»•i trá»±c tiáº¿p trÃªn URL, nhÆ°ng á»Ÿ Ä‘Ã¢y tÃ´i sáº½ sá»­ dá»¥ng cÃ´ng cá»¥ **BurpSuite**(...vÃ¬ nÃ³ ngáº§uðŸ˜hmm...)

![image2](https://live.staticflickr.com/65535/52749679640_3cd90cb06e_c.jpg)

> Sau Ä‘Ã³ khá»Ÿi Ä‘á»™ng intercept á»Ÿ tráº¡ng thÃ¡i on Ä‘á»ƒ báº¯t request gá»­i lÃªn server, sau Ä‘Ã³ truy cáº­p vÃ o **"page"**, lÃºc nÃ y request sáº½ Ä‘Æ°á»£c giá»¯ láº¡i vÃ  ta cÃ³ thá»ƒ tÃ¹y Ã½ tÃ¹y biáº¿n.

![image3](https://live.staticflickr.com/65535/52749275406_fed9733bff.jpg)

> MÃ£ hÃ³a URL á»Ÿ header tá»« /flag.txt thÃ nh /%66%6C%61%67.txt rá»“i tiáº¿n hÃ nh **"Forward"** láº¡i sáº½ thu Ä‘Æ°á»£c flag.

![image4](https://live.staticflickr.com/65535/52749784628_21a3522e44.jpg)

>

![image5](https://live.staticflickr.com/65535/52749535249_ef02a13666_c.jpg)

> Flag : **"nicc{UrL_ENC0DED_STR1NgS_AR3_SC@ry}"**
